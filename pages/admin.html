<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Getnaro Admin Pro</title>
    <link rel="stylesheet" href="/stylesheets/header.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: #e0e0e0;}
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #9F00FF; border-radius: 4px; }

        /* Theme Accents */
        .gn-border { border-color: #9F00FF; }
        .gn-text { color: #9F00FF; }
        .gn-bg { background-color: #9F00FF; }
        .gn-bg:hover { background-color: #7a00c4; }
        
        /* Loader */
        .loader { border: 3px solid #333; border-top: 3px solid #9F00FF; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Custom Toast Notification */
        #admin-toast {
            visibility: hidden; min-width: 250px; background-color: #1a1a1a; color: #fff; text-align: center;
            border-radius: 8px; padding: 16px; position: fixed; z-index: 50; left: 50%; bottom: 30px;
            transform: translateX(-50%); border: 1px solid #9F00FF; box-shadow: 0 4px 15px rgba(159, 0, 255, 0.3);
            opacity: 0; transition: opacity 0.3s, bottom 0.3s ;
        }
        #admin-toast.show { visibility: visible; opacity: 1; bottom: 50px;  }
        .container{
            position: relative;
            left: 0;
            top: 100px;
            right: 0;
            margin: auto;
            padding-bottom: 100px;
        }
        /* Custom Modal Overlay */
        #custom-modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); 
            z-index: 100; justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .modal-box {
            background: #111; border: 1px solid #333; border-left: 4px solid #9F00FF; 
            padding: 25px; width: 90%; max-width: 400px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            transform: scale(0.9); animation: popIn 0.2s forwards;
        }
        @keyframes popIn { to { transform: scale(1); } }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-black">

        <canvas id="gn-particles"></canvas>
    
    <!-- HEADER -->
    <div class="heading">
        <a href="/index.html"><img src="/assests/logo-getnaro-nobg.png" class="logo"></a>
        <h4>Getnaro</h4>
        <ul>
            <li><a href="/index.html">HOME</a></li>
            <li><a href="/pages/community.html">COMMUNITY</a></li>
            <li><a href="/pages/login.html">ACCOUNT</a></li>
            <li><a href="/pages/about.html">ABOUT US</a></li>
            <li><a href="/pages/faq.html">FAQ</a></li>
        </ul>
        <button id="theme-toggle" class="theme-toggle"><i id="theme-icon" class="fa-solid fa-moon"></i></button>
        <div id="gn-search-btn" class="gn-search-btn"><i class="fa-solid fa-magnifying-glass"></i></div>
        <a class="dl" href="/pages/getnaro-app.html"><i class="fa-solid fa-download"></i> DOWNLOAD APP</a>
    </div>

    <!-- HAMBURGER -->
    <button id="gn-hamburger" class="gn-hamburger" aria-expanded="false"><span class="gn-ham-box"><span class="gn-ham-inner"></span></span></button>
    <nav id="gn-mobile-nav" class="gn-mobile-nav">
      <div class="gn-mobile-backdrop" data-close></div>
      <div class="gn-mobile-panel">
        <button class="gn-mobile-btn gn-mobile-search"><i class="fa-solid fa-magnifying-glass"></i> <span>Search</span></button>
        <button class="gn-mobile-btn gn-mobile-theme"><i class="fa-solid fa-moon"></i> <span>Theme</span></button>
        <ul class="gn-mobile-links">
          <li><a href="/index.html">Home</a></li>
          <li><a href="/pages/community.html">Community</a></li>
          <li><a href="/pages/login.html">Account</a></li>
          <li><a href="/pages/about.html">About Us</a></li>
          <li><a href="/pages/faq.html">FAQ</a></li>
        </ul>
        <a class="gn-mobile-download" href="/pages/getnaro-app.html"><i class="fa-solid fa-download"></i> <span>Download App</span></a>
      </div>
    </nav>

    <!-- SEARCH -->
    <div id="gn-search-overlay" class="gn-search-overlay">
        <div class="gn-search-wrapper">
            <i class="fa-solid fa-magnifying-glass search-icon"></i>
            <input type="text" id="gn-search-input" placeholder="Search here" style="overflow-x: hidden;" autocomplete="off">
            <button id="gn-search-close" class="close-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="gn-search-results" class="gn-search-results"></div>
    </div>
<div class="container">
    
    <!-- CUSTOM TOAST -->
    <div id="admin-toast"><i class="fa-solid fa-info-circle"></i> <span id="toast-msg">Notification</span></div>

    <!-- CUSTOM MODAL -->
    <div id="custom-modal">
        <div class="modal-box">
            <h3 id="modal-title" class="text-xl font-bold text-white mb-2">Confirm</h3>
            <p id="modal-msg" class="text-gray-400 mb-6">Are you sure?</p>
            <div id="modal-input-container" class="hidden mb-4">
                <input type="text" id="modal-input" class="w-full bg-black border border-gray-700 p-2 text-white rounded focus:border-purple-500 outline-none">
            </div>
            <div class="flex justify-end gap-3">
                <button id="modal-cancel" class="px-4 py-2 text-gray-400 hover:text-white">Cancel</button>
                <button id="modal-confirm" class="px-6 py-2 gn-bg text-white rounded font-bold shadow-lg">Confirm</button>
            </div>
        </div>
    </div>

    <!-- LOGIN SECTION -->
    <div id="login-section" class="flex-grow flex items-center justify-center p-4">
        <div class="bg-gray-900 p-8 rounded-2xl border border-gray-800 shadow-2xl w-full max-w-md text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 gn-bg"></div>
            <i class="fa-solid fa-user-secret text-6xl gn-text mb-6"></i>
            <h2 class="text-3xl font-bold mb-8 text-white tracking-wider">ADMIN ACCESS</h2>
            <input type="email" id="admin-email" class="w-full bg-black border border-gray-700 rounded-lg p-4 mb-4 text-white focus:outline-none focus:border-purple-500 transition" placeholder="Command Email">
            <input type="password" id="admin-pass" class="w-full bg-black border border-gray-700 rounded-lg p-4 mb-8 text-white focus:outline-none focus:border-purple-500 transition" placeholder="Passkey">
            <button id="admin-login-btn" class="w-full gn-bg text-white font-bold py-4 rounded-lg hover:shadow-[0_0_20px_rgba(159,0,255,0.5)] transition duration-300 uppercase tracking-widest">
                Authenticate
            </button>
            <p id="login-msg" class="mt-6 text-red-500 text-sm font-mono"></p>
        </div>
    </div>

    <!-- DASHBOARD CONTENT -->
    <div id="dashboard-content" class="hidden w-full max-w-[1400px] mx-auto p-6 mt-8">
        
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-10 bg-gray-900 p-6 rounded-2xl border-l-4 gn-border shadow-lg gap-4">
            <div>
                <h1 class="text-4xl font-bold text-white">Getnaro <span class="gn-text">Dashboard</span></h1>
                <p class="text-gray-500 mt-1">Database Management System</p>
            </div>
            <div class="flex flex-wrap gap-3">
                <button id="import-toggle-btn" class="bg-gray-800 border border-gray-600 hover:border-purple-500 text-white px-5 py-3 rounded-lg font-bold transition flex items-center gap-2">
                    <i class="fa-solid fa-file-import text-green-400"></i> Import JSON
                </button>
                <button id="delete-all-btn" class="bg-gray-800 border border-gray-600 hover:border-red-500 text-white px-5 py-3 rounded-lg font-bold transition flex items-center gap-2">
                    <i class="fa-solid fa-radiation text-red-500"></i> Wipe DB
                </button>
                <a href="/index.html" target="_blank" class="bg-gray-800 border border-gray-600 hover:text-white hover:border-purple-500 text-gray-400 px-4 py-3 rounded-lg transition" title="View Site">
                    <i class="fa-solid fa-external-link-alt"></i>
                </a>
                <button id="logout-btn" class="bg-red-900/20 border border-red-900/50 text-red-500 hover:bg-red-600 hover:text-white px-6 py-3 rounded-lg transition font-bold">
                    Logout
                </button>
            </div>
        </div>

        <!-- THEMED IMPORT MODAL -->
        <div id="import-section" class="hidden mb-10 bg-gray-900 p-8 rounded-2xl border border-gray-700 shadow-2xl relative">
            <div class="absolute top-0 left-0 w-full h-1 bg-green-500"></div>
            <h3 class="text-2xl font-bold mb-2 text-green-400 flex items-center gap-3"><i class="fa-solid fa-database"></i> Bulk Import</h3>
            <p class="text-gray-500 mb-6 text-sm">Upload <code>apps.json</code> to restore full descriptions.</p>
            
            <div class="flex flex-col gap-6">
                <div class="relative">
                    <input type="file" id="import-file" accept=".json" class="block w-full text-sm text-gray-400 file:mr-4 file:py-3 file:px-6 file:rounded-full file:border-0 file:text-sm file:font-bold file:bg-green-600 file:text-white hover:file:bg-green-700 cursor-pointer bg-black rounded-lg border border-gray-700">
                </div>
                <textarea id="import-json-data" rows="6" class="w-full bg-black border border-gray-700 rounded-xl p-4 font-mono text-xs text-green-400 focus:outline-none focus:border-green-500 transition" placeholder='[ {"id": "app-id", ...} ]'></textarea>
            </div>
            <div class="flex gap-4 mt-6 pt-6 border-t border-gray-800">
                <button id="run-import-btn" class="bg-green-600 hover:bg-green-500 text-white px-8 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2">
                    <i class="fa-solid fa-play"></i> Run Import
                </button>
                <button id="cancel-import-btn" class="text-gray-500 hover:text-white px-6 py-3 font-bold transition">Cancel</button>
            </div>
            <p id="import-status" class="mt-4 text-sm font-bold font-mono"></p>
        </div>

        <!-- STATS -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="bg-gray-900 p-8 rounded-2xl border border-gray-800 hover:border-purple-500/50 transition group">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-gray-500 text-xs uppercase font-bold tracking-widest">Total Apps</h3>
                        <p id="total-apps-count" class="text-5xl font-bold text-white mt-2 group-hover:gn-text transition">0</p>
                    </div>
                    <i class="fa-solid fa-cubes text-3xl text-gray-800 group-hover:text-purple-500/20 transition"></i>
                </div>
            </div>
            <div class="bg-gray-900 p-8 rounded-2xl border border-gray-800 hover:border-green-500/50 transition group">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-gray-500 text-xs uppercase font-bold tracking-widest">Downloads</h3>
                        <p id="global-downloads-count" class="text-5xl font-bold text-white mt-2 group-hover:text-green-400 transition">0</p>
                    </div>
                    <i class="fa-solid fa-download text-3xl text-gray-800 group-hover:text-green-500/20 transition"></i>
                </div>
            </div>
            <div class="bg-gray-900 p-8 rounded-2xl border border-gray-800 hover:border-yellow-500/50 transition group">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-gray-500 text-xs uppercase font-bold tracking-widest">Ratings</h3>
                        <p id="total-ratings-count" class="text-5xl font-bold text-white mt-2 group-hover:text-yellow-400 transition">0</p>
                    </div>
                    <i class="fa-solid fa-star text-3xl text-gray-800 group-hover:text-yellow-500/20 transition"></i>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- EDITOR FORM -->
            <div class="lg:col-span-1 bg-gray-900 p-8 rounded-2xl border border-gray-800 h-fit sticky top-6 shadow-xl">
                <h3 class="text-xl font-bold mb-6 pb-4 border-b border-gray-800 flex items-center gap-3 text-white">
                    <i class="fa-solid fa-pen-to-square gn-text"></i> App Editor
                </h3>
                
                <input type="hidden" id="app-doc-id">

                <div class="space-y-5">
                    <div>
                        <label class="block text-xs text-gray-500 uppercase font-bold mb-2">App ID (URL Slug)</label>
                        <input type="text" id="app-id" class="w-full bg-black border border-gray-700 rounded-lg p-3 text-white focus:border-purple-500 focus:outline-none transition" placeholder="e.g. cpu-z">
                    </div>
                    
                    <div>
                        <label class="block text-xs text-gray-500 uppercase font-bold mb-2">Display Name</label>
                        <input type="text" id="app-name" class="w-full bg-black border border-gray-700 rounded-lg p-3 text-white focus:border-purple-500 focus:outline-none transition" placeholder="e.g. CPU-Z">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs text-gray-500 uppercase font-bold mb-2">Category</label>
                            <select id="app-category" class="w-full bg-black border border-gray-700 rounded-lg p-3 text-white focus:border-purple-500 focus:outline-none appearance-none cursor-pointer">
                                <option value="social">Social Media</option>
                                <option value="tools">Tools / Utilities</option>
                                <option value="opensource">Open Source</option>
                                <option value="desi">Desi Apps</option>
                                <option value="gaming">Gaming</option>
                                <option value="office">Office / Productivity</option>
                                <option value="drivers">Drivers / System</option>
                                <option value="video">Video / Graphics</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 uppercase font-bold mb-2">Version</label>
                            <input type="text" id="app-version" class="w-full bg-black border border-gray-700 rounded-lg p-3 text-white focus:border-purple-500 focus:outline-none" placeholder="v1.0">
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs text-gray-500 uppercase font-bold mb-2">Search Tags</label>
                        <input type="text" id="app-tags" class="w-full bg-black border border-gray-700 rounded-lg p-3 text-white focus:border-purple-500 focus:outline-none" placeholder="comma, separated, tags">
                    </div>

                    <div>
                        <label class="block text-xs text-gray-500 uppercase font-bold mb-2">Description</label>
                        <textarea id="app-desc" rows="5" class="w-full bg-black border border-gray-700 rounded-lg p-3 text-gray-300 focus:border-purple-500 focus:outline-none" placeholder="Full description here..."></textarea>
                    </div>

                    <div>
                        <label class="block text-xs text-gray-500 uppercase font-bold mb-2">Download Link</label>
                        <input type="text" id="app-download-link" class="w-full bg-black border border-gray-700 rounded-lg p-3 text-blue-400 focus:border-purple-500 focus:outline-none" placeholder="https://...">
                    </div>
                    
                     <div>
                        <label class="block text-xs text-gray-500 uppercase font-bold mb-2">Icon URL</label>
                        <input type="text" id="app-image" class="w-full bg-black border border-gray-700 rounded-lg p-3 text-white focus:border-purple-500 focus:outline-none" placeholder="/images/icon.png">
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button id="save-app-btn" class="flex-1 gn-bg hover:bg-purple-600 text-white py-3 rounded-lg font-bold transition shadow-lg">
                            <i class="fa-solid fa-save"></i> Save App
                        </button>
                        <button id="clear-form-btn" class="px-6 bg-gray-800 hover:bg-gray-700 text-white py-3 rounded-lg font-bold transition">
                            Clear
                        </button>
                    </div>
                </div>
            </div>

            <!-- LIST -->
            <div class="lg:col-span-2 bg-gray-900 p-8 rounded-2xl border border-gray-800 shadow-xl">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-xl font-bold text-white flex items-center gap-3"><i class="fa-solid fa-list gn-text"></i> App Library</h3>
                    <div class="relative">
                        <input type="text" id="search-apps" placeholder="Filter library..." class="bg-black border border-gray-700 rounded-full px-6 py-3 pl-12 text-sm text-white w-72 focus:border-purple-500 focus:outline-none transition">
                        <i class="fa-solid fa-search absolute left-4 top-3.5 text-gray-500"></i>
                    </div>
                </div>
                
                <div class="overflow-hidden rounded-xl border border-gray-800">
                    <table class="w-full text-left text-sm text-gray-400">
                        <thead class="bg-black text-gray-300 uppercase font-bold tracking-wider">
                            <tr>
                                <th class="px-6 py-4 border-b border-gray-800">Name / ID</th>
                                <th class="px-6 py-4 border-b border-gray-800">Category</th>
                                <th class="px-6 py-4 border-b border-gray-800 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="app-table-body" class="divide-y divide-gray-800 bg-gray-900/50">
                            <tr><td colspan="3" class="px-6 py-12 text-center text-gray-500"><div class="loader"></div><br><span class="mt-2 inline-block text-xs">Syncing with Database...</span></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<footer class="footer">
    <div class="footer-container">

        <div class="footer-col">
            <h3>Getnaro</h3>
            <p>Official download redirection hub for Windows software, tools, utilities and drivers—clean, safe & ad-free.</p>
        </div>
        <div class="footer-col">
            <h3>Quick Links</h3>
            <a href="/pages/t&c.html">Terms & Conditions</a><br>
            <a href="/pages/coc.html">Code Of Conduct</a><br>
            <a href="/pages/privacypolicy.html">Privacy Policy</a><br>
            <a href="/pages/contact.html">Contact</a>
        </div>

        <div class="footer-col">
            <h3>Follow Us</h3>
            <div class="footer-social">
                 <a href="https://www.instagram.com/narotech.india" target="_blank"><i class="fa-brands fa-instagram"></i></a>
                <a href="https://discord.gg/mcxbEsxXcQ" target="_blank"><i class="fa-brands fa-discord"></i></a>
                <a href="https://whatsapp.com/channel/0029Vb7IFu7HwXbKP3roZa0E" target="_blank"><i class="fa-brands fa-whatsapp"></i></a>
                <a href="https://www.reddit.com/r/narotech" target="_blank"><i class="fa-brands fa-reddit" ></i></a>
                <a href="https://www.youtube.com/@narotechofc" target="_blank"><i class="fa-brands fa-youtube"></i></a>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        © 2025 Getnaro — Developed by NaroTech • Hosted on GitHub • Domain by BigRock
    </div>
</footer>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot, query, writeBatch, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAJrJnSQI7X1YJHLOfHZkknmoAoiOiGuEo",
            authDomain: "getnaroapp.firebaseapp.com",
            databaseURL: "https://getnaroapp-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "getnaroapp",
            storageBucket: "getnaroapp.firebasestorage.app",
            messagingSenderId: "304744138530",
            appId: "1:304744138530:web:8166344d61cdfa127ec77b",
            measurementId: "G-FLBX24J98C"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // CUSTOM ALERT SYSTEM
        const modal = document.getElementById('custom-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMsg = document.getElementById('modal-msg');
        const modalInputDiv = document.getElementById('modal-input-container');
        const modalInput = document.getElementById('modal-input');
        const btnConfirm = document.getElementById('modal-confirm');
        const btnCancel = document.getElementById('modal-cancel');

        function showCustomPopup(title, msg, type, callback) {
            modalTitle.textContent = title;
            modalMsg.textContent = msg;
            modal.style.display = 'flex';
            
            modalInputDiv.classList.add('hidden');
            btnCancel.classList.remove('hidden');
            
            if (type === 'alert') {
                btnCancel.classList.add('hidden');
                btnConfirm.textContent = "OK";
                btnConfirm.onclick = () => { modal.style.display = 'none'; if(callback) callback(); };
            } else if (type === 'confirm') {
                btnConfirm.textContent = "Yes";
                btnConfirm.onclick = () => { modal.style.display = 'none'; if(callback) callback(true); };
                btnCancel.onclick = () => { modal.style.display = 'none'; if(callback) callback(false); };
            } else if (type === 'prompt') {
                modalInputDiv.classList.remove('hidden');
                modalInput.value = '';
                modalInput.focus();
                btnConfirm.textContent = "Submit";
                btnConfirm.onclick = () => { modal.style.display = 'none'; if(callback) callback(modalInput.value); };
                btnCancel.onclick = () => { modal.style.display = 'none'; if(callback) callback(null); };
            }
        }

        // Toast Helper
        function showToast(msg, type = 'info') {
            const toast = document.getElementById('admin-toast');
            const span = document.getElementById('toast-msg');
            span.textContent = msg;
            toast.style.borderColor = type === 'error' ? '#ef4444' : '#9F00FF';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // --- DOM Elements ---
        const els = {
            loginSection: document.getElementById('login-section'),
            dashboard: document.getElementById('dashboard-content'),
            email: document.getElementById('admin-email'),
            pass: document.getElementById('admin-pass'),
            loginBtn: document.getElementById('admin-login-btn'),
            loginMsg: document.getElementById('login-msg'),
            logoutBtn: document.getElementById('logout-btn'),
            saveBtn: document.getElementById('save-app-btn'),
            clearBtn: document.getElementById('clear-form-btn'),
            tableBody: document.getElementById('app-table-body'),
            search: document.getElementById('search-apps'),
            importToggleBtn: document.getElementById('import-toggle-btn'),
            importSection: document.getElementById('import-section'),
            importJsonData: document.getElementById('import-json-data'),
            importFileInput: document.getElementById('import-file'),
            runImportBtn: document.getElementById('run-import-btn'),
            cancelImportBtn: document.getElementById('cancel-import-btn'),
            importStatus: document.getElementById('import-status'),
            deleteAllBtn: document.getElementById('delete-all-btn'),
            inputs: {
                docId: document.getElementById('app-doc-id'),
                id: document.getElementById('app-id'),
                name: document.getElementById('app-name'),
                category: document.getElementById('app-category'),
                version: document.getElementById('app-version'),
                tags: document.getElementById('app-tags'),
                desc: document.getElementById('app-desc'),
                link: document.getElementById('app-download-link'),
                image: document.getElementById('app-image')
            },
            stats: {
                apps: document.getElementById('total-apps-count'),
                downloads: document.getElementById('global-downloads-count'),
                ratings: document.getElementById('total-ratings-count')
            }
        };

        // --- AUTH ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                els.loginSection.classList.add('hidden');
                els.dashboard.classList.remove('hidden');
                initDashboard();
            } else {
                els.loginSection.classList.remove('hidden');
                els.dashboard.classList.add('hidden');
            }
        });

        els.loginBtn.addEventListener('click', async () => {
            els.loginMsg.textContent = "Authenticating...";
            try {
                await signInWithEmailAndPassword(auth, els.email.value, els.pass.value);
            } catch (e) {
                els.loginMsg.textContent = "Access Denied: " + e.message;
            }
        });

        els.logoutBtn.addEventListener('click', () => signOut(auth));

        // --- DATA ---
        let allApps = [];

        function initDashboard() {
            loadStats();
            loadApps();
        }

        function loadStats() {
            onSnapshot(doc(db, "app_data", "global_stats"), (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    els.stats.downloads.textContent = (data.downloads || 0).toLocaleString();
                    els.stats.ratings.textContent = (data.ratingCount || 0).toLocaleString();
                }
            });
        }

        function loadApps() {
            const q = query(collection(db, "apps"));
            onSnapshot(q, (snapshot) => {
                allApps = [];
                snapshot.forEach(doc => {
                    allApps.push({ _id: doc.id, ...doc.data() });
                });
                allApps.sort((a, b) => a.name.localeCompare(b.name));
                renderTable(allApps);
                els.stats.apps.textContent = allApps.length;
            });
        }

        function renderTable(apps) {
            els.tableBody.innerHTML = '';
            if (apps.length === 0) {
                els.tableBody.innerHTML = `<tr><td colspan="3" class="px-6 py-12 text-center text-gray-500">No apps found. Try Importing JSON.</td></tr>`;
                return;
            }

            apps.forEach(app => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-800/50 transition border-b border-gray-800 last:border-0 group";
                tr.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="font-bold text-white group-hover:gn-text transition">${app.name}</div>
                        <div class="text-xs text-gray-600 font-mono">${app._id}</div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="bg-gray-800 text-gray-300 text-xs px-3 py-1 rounded-full border border-gray-700 uppercase font-bold tracking-wide">${app.category}</span>
                    </td>
                    <td class="px-6 py-4 text-right space-x-2">
                        <button class="edit-btn bg-gray-800 hover:bg-blue-600 text-gray-400 hover:text-white w-8 h-8 rounded-md transition" data-id="${app._id}"><i class="fa-solid fa-pen"></i></button>
                        <button class="view-btn bg-gray-800 hover:bg-green-600 text-gray-400 hover:text-white w-8 h-8 rounded-md transition" data-id="${app._id}"><i class="fa-solid fa-eye"></i></button>
                        <button class="del-btn bg-gray-800 hover:bg-red-600 text-gray-400 hover:text-white w-8 h-8 rounded-md transition" data-id="${app._id}"><i class="fa-solid fa-trash"></i></button>
                    </td>
                `;
                els.tableBody.appendChild(tr);
            });

            document.querySelectorAll('.edit-btn').forEach(b => b.addEventListener('click', (e) => editApp(e.currentTarget.dataset.id)));
            document.querySelectorAll('.del-btn').forEach(b => b.addEventListener('click', (e) => deleteApp(e.currentTarget.dataset.id)));
            document.querySelectorAll('.view-btn').forEach(b => b.addEventListener('click', (e) => window.open(`/pages/view.html?id=${e.currentTarget.dataset.id}`, '_blank')));
        }

        // --- ACTIONS ---
        
        els.saveBtn.addEventListener('click', async () => {
            const id = els.inputs.id.value.trim().replace(/\s+/g, '-').toLowerCase();
            if (!id || !els.inputs.name.value) return showToast("ID and Name are required", 'error');

            els.saveBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Saving...';
            els.saveBtn.disabled = true;

            const appData = {
                id: id,
                name: els.inputs.name.value,
                category: els.inputs.category.value,
                version: els.inputs.version.value,
                tags: els.inputs.tags.value.split(',').map(t => t.trim().toLowerCase()).filter(t => t),
                description: els.inputs.desc.value,
                downloadLink: els.inputs.link.value,
                image: els.inputs.image.value,
                lastUpdated: new Date().toISOString().split('T')[0]
            };

            try {
                await setDoc(doc(db, "apps", id), appData, { merge: true });
                clearForm();
                showToast("App Saved Successfully!");
            } catch (e) {
                showToast("Error: " + e.message, 'error');
            } finally {
                els.saveBtn.innerHTML = '<i class="fa-solid fa-save"></i> Save App';
                els.saveBtn.disabled = false;
            }
        });

        // THEMED DELETE ALL
        els.deleteAllBtn.addEventListener('click', () => {
            showCustomPopup("DANGER ZONE", "This will permanently delete ALL apps. Continue?", "confirm", (confirmed) => {
                if (confirmed) {
                    showCustomPopup("Verify", "Type DELETE to confirm wipe:", "prompt", async (response) => {
                        if (response === "DELETE") {
                            els.deleteAllBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Deleting...';
                            els.deleteAllBtn.disabled = true;
                            try {
                                const q = query(collection(db, "apps"));
                                const snap = await getDocs(q);
                                const batch = writeBatch(db);
                                snap.docs.forEach(doc => batch.delete(doc.ref));
                                await batch.commit();
                                showToast("Database Wiped Completely!");
                            } catch (e) {
                                showToast("Wipe Failed: " + e.message, 'error');
                            } finally {
                                els.deleteAllBtn.innerHTML = '<i class="fa-solid fa-bomb"></i> Wipe DB';
                                els.deleteAllBtn.disabled = false;
                            }
                        } else if (response !== null) {
                            showToast("Wipe Cancelled (Wrong code)", 'error');
                        }
                    });
                }
            });
        });

        // IMPORT
        els.importToggleBtn.addEventListener('click', () => els.importSection.classList.toggle('hidden'));
        els.cancelImportBtn.addEventListener('click', () => { els.importSection.classList.add('hidden'); els.importJsonData.value=''; els.importFileInput.value=''; });

        els.runImportBtn.addEventListener('click', async () => {
            let raw = els.importJsonData.value.trim();
            const file = els.importFileInput.files[0];

            if (!raw && !file) return showToast("Paste JSON or Upload File", 'error');

            els.runImportBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processing...';
            els.runImportBtn.disabled = true;
            els.importStatus.textContent = "Reading data...";
            els.importStatus.className = "mt-4 text-sm font-bold font-mono text-yellow-400";

            try {
                if (file) raw = await file.text();
                const data = JSON.parse(raw);
                if (!Array.isArray(data)) throw new Error("JSON must be an array []");

                els.importStatus.textContent = `Importing ${data.length} items...`;
                
                const batch = writeBatch(db);
                data.forEach(item => {
                    if (!item.id || !item.name) return;
                    const ref = doc(db, "apps", item.id);
                    batch.set(ref, { ...item, lastUpdated: new Date().toISOString().split('T')[0] }, { merge: true });
                });

                await batch.commit();
                showToast(`Success! Imported ${data.length} apps.`);
                els.importStatus.textContent = "Done!";
                els.importStatus.className = "mt-4 text-sm font-bold font-mono text-green-400";
                setTimeout(() => {
                    els.importSection.classList.add('hidden');
                    els.importStatus.textContent = "";
                }, 1500);

            } catch (e) {
                showToast("Import Failed", 'error');
                els.importStatus.textContent = "Error: " + e.message;
                els.importStatus.className = "mt-4 text-sm font-bold font-mono text-red-500";
            } finally {
                els.runImportBtn.innerHTML = '<i class="fa-solid fa-play"></i> Run Import';
                els.runImportBtn.disabled = false;
            }
        });

        function editApp(id) {
            const app = allApps.find(a => a._id === id);
            if (!app) return;
            els.inputs.docId.value = app._id; els.inputs.id.value = app.id; els.inputs.name.value = app.name;
            els.inputs.category.value = app.category; els.inputs.version.value = app.version || '';
            els.inputs.tags.value = (app.tags || []).join(', '); els.inputs.desc.value = app.description || '';
            els.inputs.link.value = app.downloadLink || ''; els.inputs.image.value = app.image || '';
            els.inputs.id.disabled = true; 
            els.saveBtn.innerHTML = '<i class="fa-solid fa-pen"></i> Update App';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function deleteApp(id) {
            showCustomPopup("Delete App", `Permanently delete ${id}?`, "confirm", async (confirmed) => {
                if (confirmed) {
                    try {
                        await deleteDoc(doc(db, "apps", id));
                        showToast("App Deleted");
                    } catch(e) { showToast(e.message, 'error'); }
                }
            });
        }

        function clearForm() {
            els.inputs.docId.value=''; els.inputs.id.value=''; els.inputs.id.disabled=false;
            els.inputs.name.value=''; els.inputs.version.value=''; els.inputs.tags.value='';
            els.inputs.desc.value=''; els.inputs.link.value=''; els.inputs.image.value='';
            els.saveBtn.innerHTML = '<i class="fa-solid fa-save"></i> Save App';
        }
        els.clearBtn.addEventListener('click', clearForm);
        
        els.search.addEventListener('input', (e) => {
            const t = e.target.value.toLowerCase();
            renderTable(allApps.filter(a => a.name.toLowerCase().includes(t) || a._id.includes(t)));
        });
    </script>
</body>
</html>