<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Getnaro - App View</title>
    <!-- Root-relative paths used here -->
    <link rel="stylesheet" href="/stylesheets/header.css">
    <link rel="stylesheet" href="/stylesheets/ai_assistant.css">
    <link rel="stylesheet" href="/stylesheets/downloads.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <meta name="robots" content="index, follow">
    <link rel="icon" type="image/x-icon" href="/assests/Favicon.png">
    <style>
        .loading-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100; display: flex; justify-content: center; align-items: center;
        }
        .loader-spinner {
            border: 4px solid #333; border-top: 4px solid #9F00FF; border-radius: 50%;
            width: 50px; height: 50px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <canvas id="gn-particles"></canvas>
    
    <!-- HEADER -->
    <div class="heading">
        <a href="/index.html"><img src="/assests/logo-getnaro-nobg.png" class="logo"></a>
        <h4>Getnaro</h4>
        <ul>
            <li><a href="/index.html">HOME</a></li>
            <li><a href="/pages/community.html">COMMUNITY</a></li>
            <li><a href="/pages/login.html">ACCOUNT</a></li>
            <li><a href="/pages/about.html">ABOUT US</a></li>
            <li><a href="/pages/faq.html">FAQ</a></li>
        </ul>
        <button id="theme-toggle" class="theme-toggle"><i id="theme-icon" class="fa-solid fa-moon"></i></button>
        <div id="gn-search-btn" class="gn-search-btn"><i class="fa-solid fa-magnifying-glass"></i></div>
        <a class="dl" href="/pages/getnaro-app.html"><i class="fa-solid fa-download"></i> DOWNLOAD APP</a>
    </div>

    <!-- HAMBURGER -->
    <button id="gn-hamburger" class="gn-hamburger" aria-expanded="false"><span class="gn-ham-box"><span class="gn-ham-inner"></span></span></button>
    <nav id="gn-mobile-nav" class="gn-mobile-nav">
      <div class="gn-mobile-backdrop" data-close></div>
      <div class="gn-mobile-panel">
        <button class="gn-mobile-btn gn-mobile-search"><i class="fa-solid fa-magnifying-glass"></i> <span>Search</span></button>
        <button class="gn-mobile-btn gn-mobile-theme"><i class="fa-solid fa-moon"></i> <span>Theme</span></button>
        <ul class="gn-mobile-links">
          <li><a href="/index.html">Home</a></li>
          <li><a href="/pages/community.html">Community</a></li>
          <li><a href="/pages/login.html">Account</a></li>
          <li><a href="/pages/about.html">About Us</a></li>
          <li><a href="/pages/faq.html">FAQ</a></li>
        </ul>
        <a class="gn-mobile-download" href="/pages/getnaro-app.html"><i class="fa-solid fa-download"></i> <span>Download App</span></a>
      </div>
    </nav>

    <!-- SEARCH -->
    <div id="gn-search-overlay" class="gn-search-overlay">
        <div class="gn-search-wrapper">
            <i class="fa-solid fa-magnifying-glass search-icon"></i>
            <input type="text" id="gn-search-input" placeholder="Search here" style="overflow-x: hidden;" autocomplete="off">
            <button id="gn-search-close" class="close-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="gn-search-results" class="gn-search-results"></div>
    </div>

    <!-- AI BOT -->
    <div id="gn-ai-root">
        <div class="gn-ai-fab" id="gn-ai-trigger"><i class="fa-solid fa-robot" style="color: white !important;"></i> <span>Chat Now</span></div>
        <div class="gn-ai-overlay" id="gn-ai-overlay">
            <div class="gn-ai-box">
                <div class="gn-ai-header">
                    <div class="gn-ai-title">
                        <div class="gn-bot-avatar"><i class="fa-solid fa-brain" style="color: aliceblue !important;"></i></div>
                        <div class="gn-ai-info"><h3>Getnaro Assistant</h3><p>AI Powered ‚Ä¢ Voice Enabled</p></div>
                    </div>
                    <button class="gn-ai-close" id="gn-ai-close"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="gn-ai-messages" id="gn-ai-chat"><div class="msg bot">Hello! I'm your Getnaro Assistant.</div></div>
                <div class="gn-ai-input-area">
                    <button class="gn-ai-btn" id="btn-mic"><i class="fa-solid fa-microphone"></i></button>
                    <button class="gn-ai-btn" id="btn-speaker"><i class="fa-solid fa-volume-high"></i></button>
                    <input type="text" class="gn-ai-input" id="gn-ai-input" placeholder="Ask something..">
                    <button class="gn-ai-btn" id="btn-send"><i class="fa-solid fa-paper-plane" style="color: aliceblue !important;"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- DYNAMIC CONTENT -->
    <div class="container" id="dynamic-container">
        
        <div class="fs-page-wrapper content-one" id="app-card-root" style="display:none; opacity: 0; transition: opacity 0.5s ease;">
            
            <!-- LEFT SIDE (Visuals Only) -->
            <div class="fs-visual-side">
                <div class="fs-blob blob-1"></div>
                <div class="fs-blob blob-2"></div>
                
                <div class="fs-logo-container gn-card-left">
                    <img id="d-app-image" src="" alt="App Logo">
                </div>
            </div>

            <!-- RIGHT SIDE (Content + Carousel) -->
            <div class="fs-content-side">
                <div class="fs-inner-content">
                    
                    <!-- 1. Category -->
                    <span class="fs-category" id="d-app-category">Category</span>
                    
                    <!-- 2. App Name -->
                    <h1 class="fs-title" id="d-app-title">Loading...</h1>
                    
                    <!-- 3. Buttons -->
                    <div class="fs-actions" style="margin-bottom: 30px;">
                        <a href="#" class="fs-btn gn-btn-download" id="d-btn-download" target="_blank"><i class="fa-solid fa-download"></i> DOWNLOAD NOW</a>
                        
                        <!-- OPEN BUTTON (Hidden by default, shown by Electron) -->
                        <button class="fs-btn gn-btn-open" id="d-btn-open" style="display: none;"><i class="fa-solid fa-arrow-up-right-from-square"></i> OPEN APP</button>
                        
                        <a href="#" class="fs-btn gn-btn-update" id="d-btn-update" style="display: none;"><i class="fa-solid fa-rotate"></i> UPDATE</a>
                        <a href="#" class="fs-btn gn-btn-uninstall" id="d-btn-uninstall" style="display: none;"><i class="fa-solid fa-trash"></i> UNINSTALL</a>

                        <!-- FAVORITE BUTTON -->
                        <button class="fs-btn gn-btn-fav" id="d-btn-fav" title="Add to Favorites"><i class="fa-regular fa-heart"></i></button>
                    </div>

                    <!-- 4. Installation Details -->
                    <div class="fs-details-group">
                        <div class="fs-stats">
                            <div class="fs-stat-item"><h6>Version</h6><p id="d-app-version">Latest</p></div>
                            <div class="fs-stat-item"><h6>Updated</h6><p id="d-app-updated">Today</p></div>
                            <div class="fs-stat-item"><h6>Status</h6><p class="fs-verified"><i class="fa-solid fa-shield-halved"></i> Verified</p></div>
                        </div>

                        <div class="fs-glossy-box">
                            <div class="fs-glossy-col"><h6>Installed Date</h6><p id="install-status-dynamic">Not Installed</p></div>
                            <div class="fs-glossy-col" style="flex-grow: 1;">
                                <h6>Location</h6>
                                <div class="fs-loc-wrapper">
                                    <i class="fa-regular fa-folder-open" style="font-size: 0.9rem; opacity: 0.7;"></i>
                                    <a href="#" class="fs-loc-link" id="loc-path-dynamic" title="Open Location">‚Äî</a>
                                    <button class="fs-copy-btn" onclick="copyToClipboard('loc-path-dynamic')" title="Copy Path"><i class="fa-regular fa-copy"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 5. Paragraph (Description) -->
                    <p class="fs-desc" id="d-app-desc">Loading application details...</p>

                    <!-- 6. Carousel (Moved Here) -->
                    <div class="fs-carousel-container" id="fs-carousel-root">
                        <div class="fs-carousel-track" id="fs-carousel-track">
                            <!-- Images injected by JS -->
                        </div>
                    </div>

                </div>
            </div>

            <div id="gn-toast" class="gn-custom-toast"><i class="fa-solid fa-check-circle"></i><span id="gn-toast-msg">Path copied to clipboard!</span></div>
        </div>

        <!-- 3-Second Loading Screen -->
        <div id="page-loader" class="loading-overlay"><div class="loader-spinner"></div></div>

        <!-- Lightbox for Carousel -->
        <div id="gn-lightbox" class="gn-lightbox">
            <span class="gn-lightbox-close" onclick="closeLightbox()">&times;</span>
            <img class="gn-lightbox-content" id="gn-lightbox-img">
            <div id="gn-lightbox-caption"></div>
        </div>

    
  <footer class="footer">
    <div class="footer-container">

        <div class="footer-col">
            <h3>Getnaro</h3>
            <p>Official download redirection hub for Windows software, tools, utilities and drivers‚Äîclean, safe & ad-free.</p>
        </div>
        <div class="footer-col">
            <h3>Quick Links</h3>
            <a href="/pages/t&c.html">Terms & Conditions</a><br>
            <a href="/pages/coc.html">Code Of Conduct</a><br>
            <a href="/pages/privacypolicy.html">Privacy Policy</a><br>
            <a href="/pages/contact.html">Contact</a>
        </div>

        <div class="footer-col">
            <h3>Follow Us</h3>
            <div class="footer-social">
                 <a href="https://www.instagram.com/narotech.india" target="_blank"><i class="fa-brands fa-instagram"></i></a>
                <a href="https://discord.gg/mcxbEsxXcQ" target="_blank"><i class="fa-brands fa-discord"></i></a>
                <a href="https://whatsapp.com/channel/0029Vb7IFu7HwXbKP3roZa0E" target="_blank"><i class="fa-brands fa-whatsapp"></i></a>
                <a href="https://www.reddit.com/r/narotech" target="_blank"><i class="fa-brands fa-reddit" ></i></a>
                <a href="https://www.youtube.com/@narotechofc" target="_blank"><i class="fa-brands fa-youtube"></i></a>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        ¬© 2025 Getnaro ‚Äî Developed by <a href="/pages/narotech.html" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">Narotech</a> ‚Ä¢ Hosted on GitHub ‚Ä¢ Domain by BigRock
    </div>
</footer>
<script src="/scripts/tod.js"></script>
<script src="/scripts/particles.js"></script>
<script src="/scripts/theme.js"></script>
<script src="/scripts/hamburger.js"></script>
<script type="module" src="/scripts/appstats.js"></script>
<script type="module" src="/scripts/app_tracking.js"></script>
<script type="module" src="/scripts/header_auth.js"></script>
<script type="module" src="/scripts/firebase-config.js"></script>
<script type="module" src="/scripts/ai_assistant.js"></script>
<script type="module" src="/scripts/stats.js"></script>

    <script>
        function showToast(message) {
            const toast = document.getElementById("gn-toast");
            const toastMsg = document.getElementById("gn-toast-msg");
            if (toast && toastMsg) {
                toastMsg.innerText = message;
                toast.className = "gn-custom-toast show";
                setTimeout(() => toast.className = toast.className.replace("show", ""), 3000);
            }
        }
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;
            navigator.clipboard.writeText(element.innerText).then(() => {
                showToast("Path copied to clipboard!");
            }).catch(err => showToast("Failed to copy path."));
        }

        // Lightbox Functions
        window.openLightbox = function(src, caption) {
            const lightbox = document.getElementById("gn-lightbox");
            const lightboxImg = document.getElementById("gn-lightbox-img");
            const captionText = document.getElementById("gn-lightbox-caption");
            
            lightbox.style.display = "flex";
            setTimeout(() => lightbox.classList.add('active'), 10);
            
            lightboxImg.src = src;
            captionText.innerHTML = caption || "";
        }

        window.closeLightbox = function() {
            const lightbox = document.getElementById("gn-lightbox");
            lightbox.classList.remove('active');
            setTimeout(() => lightbox.style.display = "none", 300);
        }
    </script>

<script type="module">
    // Import from centralized config
    import { mainApp } from "/scripts/firebase-config.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getDatabase, ref, runTransaction, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
    
    // NOTE: app_tracking.js is now standalone. We don't import it here.
    // It will detect the DOM ready state and run itself.

    const db = getFirestore(mainApp);      
    const rtdb = getDatabase(mainApp);     

    console.log("üî• Firebase initialized in View Page");

    // --- STATS TRACKING ---
    const visitRef = ref(rtdb, "stats/total_visits");
    runTransaction(visitRef, (current) => (current || 0) + 1);

    const liveRef = ref(rtdb, "stats/live_visitors");
    const peakRef = ref(rtdb, "stats/peak_visitors");
    const connectedRef = ref(rtdb, ".info/connected");

    onValue(connectedRef, (snap) => {
        if (snap.val() === true) {
            runTransaction(liveRef, (current) => {
                const newVal = (current || 0) + 1;
                runTransaction(peakRef, (peak) => (newVal > (peak || 0) ? newVal : peak));
                return newVal;
            });
            onDisconnect(liveRef).transaction((current) => (current && current > 0) ? current - 1 : 0);
        }
    });

    // --- APP LOADER ---
    async function loadApp() {
        console.log("üöÄ Starting App Load...");
        
        const urlParams = new URLSearchParams(window.location.search);
        const appId = urlParams.get('id');

        if (!appId) {
            console.error('‚ùå No app ID provided in URL');
            document.getElementById('page-loader').style.display = 'none';
            // Optional: Redirect to home
            // window.location.href = '/index.html';
            return;
        }

        console.log(`üîé Fetching data for ID: ${appId}`);

        try {
            const docRef = doc(db, "apps", appId);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                console.log("‚úÖ Document found:", docSnap.data());
                const data = docSnap.data();
                
                // Populate DOM
                document.getElementById('d-app-title').innerText = data.name || "Unknown App";
                document.getElementById('d-app-desc').innerText = data.description || "No description available.";
                document.getElementById('d-app-category').innerText = data.category || "Software";
                document.getElementById('d-app-version').innerText = data.version || "Latest";
                document.getElementById('d-app-updated').innerText = data.lastUpdated || "Recently";
                
                const mainImgSrc = data.image || "/assests/logo-getnaro-nobg.png";
                const img = document.getElementById('d-app-image');
                img.src = mainImgSrc;
                img.onerror = () => { img.src = "/assests/logo-getnaro-nobg.png"; };

                // CAROUSEL LOGIC
                const carouselTrack = document.getElementById('fs-carousel-track');
                const screenshots = data.screenshots || [mainImgSrc]; 
                
                if (screenshots && screenshots.length > 0) {
                    carouselTrack.innerHTML = '';
                    screenshots.forEach(src => {
                        const slide = document.createElement('div');
                        slide.className = 'fs-carousel-item';
                        const slideImg = document.createElement('img');
                        slideImg.src = src;
                        slideImg.onclick = () => window.openLightbox(src, data.name);
                        slide.appendChild(slideImg);
                        carouselTrack.appendChild(slide);
                    });
                }

                // Download Button Logic
                const dlBtn = document.getElementById('d-btn-download');
                if (data.downloadLink) {
                    dlBtn.href = data.downloadLink;
                    // Stats recording
                    dlBtn.addEventListener("click", () => {
                        const totalDlRef = ref(rtdb, "stats/total_downloads");
                        runTransaction(totalDlRef, (current) => (current || 0) + 1);
                        const safeName = data.name.replace(/[.#$/\[\]]/g, "_"); 
                        const appDlRef = ref(rtdb, `app_downloads/${safeName}`);
                        runTransaction(appDlRef, (current) => (current || 0) + 1);
                    }, { once: false });
                } else {
                    dlBtn.style.opacity = "0.5";
                    dlBtn.innerText = "Unavailable";
                    dlBtn.href = "#";
                }

                // Initialize Wrapper
                const wrapper = document.getElementById('app-card-root');
                wrapper.setAttribute('data-app', appId);
                wrapper.setAttribute('data-category', data.category || "tools");
                wrapper.setAttribute('data-last-updated', data.lastUpdated || ""); // Essential for tracking script
                
                document.title = `${data.name} - Download at Getnaro`;

                // REVEAL UI
                setTimeout(() => {
                    console.log("‚ú® Revealing UI");
                    document.getElementById('page-loader').style.display = 'none';
                    wrapper.style.display = 'flex';
                    // Force reflow
                    void wrapper.offsetWidth; 
                    wrapper.style.opacity = '1';
                }, 1000); // Reduced to 1s for better UX, tracking script handles the rest

            } else {
                console.error('‚ùå App document does not exist in Firestore "apps" collection.');
                document.getElementById('page-loader').style.display = 'none';
                document.getElementById('d-app-title').innerText = "App Not Found";
                document.getElementById('app-card-root').style.display = 'flex';
                document.getElementById('app-card-root').style.opacity = '1';
            }
        } catch (error) {
            console.error("‚ùå Critical Error loading app:", error);
            document.getElementById('page-loader').style.display = 'none';
            alert("Failed to load app data. Check console for details.");
        }
    }
    
    // Ensure DOM is ready before running
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadApp);
    } else {
        loadApp();
    }
</script>
</body>
</html>